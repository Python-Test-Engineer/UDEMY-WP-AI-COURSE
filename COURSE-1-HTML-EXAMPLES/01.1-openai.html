<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OpenAI API in Browser</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <link rel="stylesheet" href="01-style.css">
</head>

<body>
   <h1>OpenAI API in Browser</h1>

   <input type="text" id="apiKey" placeholder="Enter your OpenAI API key" value="" autocomplete="off"
      data-form-type="other">
   <input type="text" id="prompt" placeholder="Enter your prompt" value="Capital of England?">

   <button id="sendBtn" type="submit">Send Request</button>

   <br>
   <div id="result"></div>

   <script>

      document.getElementById('sendBtn').addEventListener('click', async () => {
         const apiKey = document.getElementById('apiKey').value;
         const prompt = document.getElementById('prompt').value;
         const resultDiv = document.getElementById('result');


         if (!apiKey) {
            resultDiv.innerHTML = '<p style="color: red;">Please enter your API key</p>';
            return;
         }

         resultDiv.innerHTML = '<p>Loading...</p>';
         system_prompt = `
         You are a helpful assistant. You always answer in a concise manner. 

         You never refuse to answer but do not make things up - just say 'I don't know'. You always try to help the user as much as possible. 

         Convert markdown to HTML when needed so that ouput is properly formatted. Ensure there is a new line after each sentence.`;

         // ******************** AI BIT ********************
         try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json', // Tells the server we're sending JSON data.
                  'Authorization': `Bearer ${apiKey}` // Authenticates our request using the API key.
               },
               body: JSON.stringify({
                  model: 'gpt-4o-mini', // Specifies which AI model to use (a smaller, efficient version of GPT-4).
                  messages: [
                     { role: 'system', content: system_prompt }, // Defines how the AI agent should behave (its "personality" and rules).
                     { role: 'user', content: prompt } // The user's input/query for the agent to respond to.
                  ], // Models are trained to understand these roles to generate appropriate responses so we use the same format.

                  max_tokens: 1024, // Limits the response length to prevent excessive output. A token in LLM (Large Language Model) terminology is the basic unit of text that the model processes. Think of it as the fundamental "chunk" that the AI reads and generates. You can typically estimate roughly 1 token â‰ˆ 4 characters or 0.75 words in English, though this varies significantly based on the text.

                  temperature: 0.7 // Controls randomness: 0.0 = very predictable/deterministic, 1.0 = very creative/random. 0.7 provides a good balance for natural, varied responses without being too unpredictable. !!! We will look at TEMEPERATURE in another video...
               })
            });

            const data = await response.json();
            // ******************** AI BIT ********************

            // NB No mememory every call is stateless
            const msg = data.choices[0].message.content; // We can drill down for the content of the first message choice to get the 'answer'.
            console.log('API Response:', data);
            console.log(data);
            let output = "";

            if (data.error) {
               resultDiv.innerHTML = `<p style="color: red;">Error: ${data.error.message}</p>`;
            } else {
               resultDiv.innerHTML = `<p><strong>Response:</strong></p><p>${output + '<br>' + msg}</p>`;
            }
         } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
         }
      });
   </script>
</body>

</html>