<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OpenAI Structured Output Example</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <style>
      body {
         font-family: 'Raleway', sans-serif;
         max-width: 800px;
         margin: 50px auto;
         padding: 20px;
         background: #f5f5f5;
      }

      h1 {
         color: #333;
         font-size: 2em;
         margin-bottom: 30px;
      }

      input[type="text"] {
         width: 100%;
         padding: 12px;
         margin: 10px 0;
         border: 2px solid #ddd;
         border-radius: 5px;
         font-size: 16px;
         font-family: 'Fira Code', monospace;
      }

      button {
         background: #007bff;
         color: white;
         padding: 12px 30px;
         border: none;
         border-radius: 5px;
         font-size: 16px;
         cursor: pointer;
         margin: 10px 0;
      }

      button:hover {
         background: #0056b3;
      }

      #result {
         background: white;
         padding: 20px;
         border-radius: 5px;
         margin-top: 20px;
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      #jsonOutput {
         background: #1e1e1e;
         color: #d4d4d4;
         padding: 20px;
         border-radius: 5px;
         margin-top: 20px;
         box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
         font-family: 'Fira Code', monospace;
         overflow-x: auto;
      }

      #jsonOutput h3 {
         color: #4ec9b0;
         margin-top: 0;
      }

      #jsonOutput pre {
         margin: 0;
         white-space: pre-wrap;
         word-wrap: break-word;
      }

      .city-card {
         border-left: 4px solid #007bff;
         padding-left: 15px;
      }

      .city-card h2 {
         margin: 0 0 10px 0;
         color: #007bff;
      }

      .city-info {
         margin: 10px 0;
      }

      .landmarks {
         margin-top: 15px;
      }

      .landmarks ul {
         list-style-type: none;
         padding: 0;
      }

      .landmarks li {
         background: #f8f9fa;
         padding: 8px;
         margin: 5px 0;
         border-radius: 3px;
      }

      .error {
         color: red;
      }
   </style>
</head>

<body>
   <h1>OpenAI Structured Output Example</h1>

   <input type="text" id="apiKey" placeholder="Enter your OpenAI API key" value="" autocomplete="off"
      data-form-type="other">
   <input type="text" id="prompt" placeholder="Ask about a city (e.g., 'Tell me about Paris')"
      value="Tell me about London">

   <button id="sendBtn" type="submit">Get City Information</button>

   <br>
   <!-- Returned Structured JSON Output: -->
   <div id="jsonOutput"></div>
   <!-- Custom Styled Display Area: -->
   <div id="result"></div>

   <script>

      document.getElementById('sendBtn').addEventListener('click', async () => {
         const apiKey = document.getElementById('apiKey').value;
         const prompt = document.getElementById('prompt').value;
         const resultDiv = document.getElementById('result');

         if (!apiKey) {
            resultDiv.innerHTML = '<p class="error">Please enter your API key</p>';
            return;
         }

         resultDiv.innerHTML = '<p>Loading...</p>';

         // Define the JSON schema for structured output
         const responseSchema = {
            type: "object",
            properties: {
               city_name: {
                  type: "string",
                  description: "The name of the city"
               },
               country: {
                  type: "string",
                  description: "The country where the city is located"
               },
               population: {
                  type: "number",
                  description: "The approximate population of the city"
               },
               famous_landmarks: {
                  type: "array",
                  description: "List of famous landmarks in the city",
                  items: {
                     type: "string"
                  }
               },
               fun_fact: {
                  type: "string",
                  description: "An interesting fact about the city"
               }
            },
            required: ["city_name", "country", "population", "famous_landmarks", "fun_fact"],
            additionalProperties: false
         };

         try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${apiKey}`
               },
               body: JSON.stringify({
                  model: 'gpt-4o-mini',
                  messages: [
                     {
                        role: 'system',
                        content: 'You are a helpful assistant that provides structured information about cities.'
                     },
                     {
                        role: 'user',
                        content: prompt
                     }
                  ],
                  response_format: {
                     type: "json_schema",
                     json_schema: {
                        name: "city_information",
                        strict: true,
                        schema: responseSchema
                     }
                  },
                  temperature: 0.7
               })
            });

            const data = await response.json();
            console.log('API Response:', data);

            if (data.error) {
               resultDiv.innerHTML = `<p class="error">Error: ${data.error.message}</p>`;
               document.getElementById('jsonOutput').innerHTML = '';
            } else {
               // Parse the structured JSON response
               const cityInfo = JSON.parse(data.choices[0].message.content);

               // Display the structured data in a nice format
               resultDiv.innerHTML = `
                  <div class="city-card">
                     <h1>JSON Schema Structured Output formatted</h1>
                     <h2>${cityInfo.city_name}, ${cityInfo.country}</h2>
                     <div class="city-info">
                        <strong>Population:</strong> ${cityInfo.population.toLocaleString()}
                     </div>
                     <div class="city-info">
                        <strong>Fun Fact:</strong> ${cityInfo.fun_fact}
                     </div>
                     <div class="landmarks">
                        <strong>Famous Landmarks:</strong>
                        <ul>
                           ${cityInfo.famous_landmarks.map(landmark => `<li>${landmark}</li>`).join('')}
                        </ul>
                     </div>
                  </div>
               `;

               // Display the raw JSON output
               document.getElementById('jsonOutput').innerHTML = `
                  <h3>Raw Structured JSON Output Returned:</h3>
                  <pre>${JSON.stringify(cityInfo, null, 2)}</pre>
               `;
            }
         } catch (error) {
            resultDiv.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            document.getElementById('jsonOutput').innerHTML = '';
         }
      });
   </script>
</body>

</html>