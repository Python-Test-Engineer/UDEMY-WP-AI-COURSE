<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OpenAI API in Browser</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <link rel="stylesheet" href="01-style.css">
</head>

<body>
   <h1>OpenAI API in Browser</h1>
   <input type="text" id="apiKey" placeholder="Enter your OpenAI API key" value="" autocomplete="off"
      data-form-type="other">
   <input type="text" id="prompt" placeholder="Enter your prompt" value="When was the first meetup held?"
      autocomplete="off">

   <button id="sendBtn" type="submit">Send Request</button>

   <br>
   <div id="result"></div>

   <script>
      document.getElementById('sendBtn').addEventListener('click', async () => {
         const apiKey = document.getElementById('apiKey').value;
         const prompt = document.getElementById('prompt').value;
         const resultDiv = document.getElementById('result');


         if (!apiKey) {
            resultDiv.innerHTML = '<p style="color: red;">Please enter your API key</p>';
            return;
         }

         resultDiv.innerHTML = '<p>Loading...</p>';
         system_prompt = `
         You are a helpful assistant. You always answer in a concise manner. 
         You never refuse to answer but do not make things up - just say 'I don't know'. You always try to help the user as much as possible. 
         Convert markdown to HTML when needed so that ouput is properly formatted.Ensure there is a new line after each sentence.
     
         `;

         // We can add additional context for RAG (Retrieval Augmented Generation) here which was not in trained model. It can also be dynamic content retrieved from a database or API - we will see that later.
         RAG = `
            Brighton Web Development Meet Up is taking place on October 29th.
            The venue is the Skiff.
            The event starts at 6:30 PM and finishes at 9:00 PM.
            The Speaker is Craig West and the topic is 'AI Agents and Evals for all languages'
            Brighton Web Development Meet Up is part of Silicon Brighton.
            The current organiser is Gavin and it has been running since <strong>1865 (3rd October 1865)</strong> the first meetup being organised by Peter.
            Similar meet ups are WordUp Brighton, BrightonPy, PHP Sussex and many more.
            Details at siliconbrighton.com.`

         system_prompt += RAG;
         console.log(system_prompt);

         // ******************** AI BIT ********************


         try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${apiKey}`
               },
               body: JSON.stringify({
                  model: 'gpt-4o-mini',
                  messages: [{ role: 'system', content: system_prompt }, { role: 'user', content: prompt }],
                  max_tokens: 1024
               })
            });

            const data = await response.json();
            console.log('API Response:', data);
            const msg = data.choices[0].message.content;
            let output = "";


            if (data.error) {
               resultDiv.innerHTML = `<p style="color: red;">Error: ${data.error.message}</p>`;
            } else {
               resultDiv.innerHTML = `<p><strong>Response:</strong></p><p>${output + '<br>' + data.choices[0].message.content}</p>`;
            }
         } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
         }
      });
   </script>
</body>

</html>